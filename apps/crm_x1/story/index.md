# 客户商机管理系统 ～ Lead-Opportunity CRM

## 产品需求文档（BDD / Gherkin）

## 1. 项目概述与背景

客户商机管理系统（Lead-Opportunity CRM，以下简称 **CRM**）用于统一管理销售流程中的 **客户信息**、**拜访记录** 与 **商机（Opportunity）**，并通过可视化统计看板帮助管理层洞察业务全局、优化资源投入。  
典型痛点：

1. 信息割裂 —— 客户资料、拜访记录与商机分散在表格或聊天工具中，难以追踪转化链路。  
2. 缺乏数据驱动 —— 缺乏漏斗与转化率分析，管理层无法实时掌握瓶颈。  
3. 审批不透明 —— 线索转商机过程依赖邮件/IM 审批，过程不可追溯。  

本系统通过 **角色分工**（销售人员 & 管理者）、**标准化流程**（线索 → 商机 → 合同）及 **可配置报表**，以 BDD 驱动方式保证需求、测试与实现一致性。

## 2. Feature 概览

### 2.1 功能场景摘要

| Feature | Rule | Scenario/Outline | 类型 | 测试用例数 |
| --- | --- | --- | --- | --- |
| **客户管理** | 创建客户 | 新建客户成功 | Scenario | 1 |
|  | 编辑客户 | 批量字段修改 | Scenario Outline | 2 |
|  | 必填校验 | 缺失必填字段拦截 | Scenario | 1 |
| **拜访记录管理** | 创建拜访 | 记录一次拜访 | Scenario Outline | 2 |
|  | 权限查看 | 管理者查看全部 | Scenario | 1 |
| **商机管理** | 发起转商机 | 创建商机申请 | Scenario | 1 |
|  | 维护商机 | 更新商机阶段 | Scenario Outline | 2 |
| **审批流程** | 转商机审批 | 审批通过 / 驳回 | Scenario ×2 | 2 |
|  | 权限校验 | 非管理者审批拦截 | Scenario | 1 |
| **统计分析** | 漏斗分析 | 查看商机漏斗 | Scenario | 1 |
|  | 转化率 | 计算拜访→商机转化率 | Scenario Outline | 2 |
|  | 数据权限 | 销售仅看个人数据 | Scenario | 1 |

### 2.2 功能场景地图

（仅示例关键节点）

```
flowchart TD
    Root[客户商机管理系统] --> A1[客户管理]
    Root --> B1[拜访记录管理]
    Root --> C1[商机管理]
    Root --> D1[审批流程]
    Root --> E1[统计分析]

    A1 --> A1R1[创建客户]
    A1 --> A1R2[编辑客户]
    B1 --> B1R1[创建拜访]
    C1 --> C1R1[发起转商机]
    C1 --> C1R2[维护商机]
    D1 --> D1R1[审批商机]
    E1 --> E1R1[商机漏斗]
```

## 3. 详细 Gherkin 用例

### 3.1 Feature: 客户管理

```
Feature: 客户管理
  为销售流程提供统一的客户主数据，支撑拜访与商机阶段的精准归属。

  Background:
    Given 系统已定义「客户字段配置表」:
      | 字段         | 类型   | 是否必填 |
      | 客户名称     | 文本   | 是       |
      | 客户行业     | 选项   | 是       |
      | 客户分层     | 选项   | 是       |
      | 人员规模     | 选项   | 否       |
      | 国家/地区   | 选项   | 否       |
      | 官方网站     | URL    | 否       |

  Rule: 创建客户
    Scenario: 新建客户成功
      Given 销售人员已登录系统
      When 在客户列表点击「新建客户」
      And 输入:
        | 客户名称 |=| "上海星辰科技" |
        | 客户行业 |=| "软件"         |
        | 客户分层 |=| "A"            |
      And 点击「保存」
      Then 系统提示 "创建成功"
      And 客户列表出现 "上海星辰科技"

  Rule: 编辑客户
    Scenario Outline: 批量字段修改
      Given 已存在客户 "<客户名称>"
      When 销售人员将 "<字段>" 修改为 "<新值>"
      And 点击「保存」
      Then "<字段>" 应显示为 "<新值>"
      And 系统记录一条修改日志

      Examples:
        | 客户名称     | 字段     | 新值            |
        | 上海星辰科技 | 官方网站 | https://xing.com |
        | 华北数码集团 | 客户分层 | B              |

  Rule: 必填字段校验
    Scenario: 缺失必填字段拦截
      Given 销售人员点击「新建客户」
      When 仅填写 "客户行业=制造业"
      And 点击「保存」
      Then 系统提示 "客户名称为必填项"
      And 不保存记录
```

### 3.2 Feature: 拜访记录管理

```
Feature: 拜访记录管理
  记录销售与客户的接触详情，为商机转化提供量化依据。

  Background:
    Given 系统已定义「拜访记录字段配置表」:
      | 字段         | 类型 | 是否必填 |
      | 客户         | 关联 | 是       |
      | 拜访日期     | 日期 | 是       |
      | 客户阶段     | 选项 | 是       |
      | 详细沟通记录 | 文本 | 否       |

  Rule: 创建拜访
    Scenario Outline: 记录一次拜访
      Given 已存在客户 "<客户名称>"
      When 销售人员点击「新建拜访记录」
      And 选择客户 "<客户名称>"
      And 选择日期 "<拜访日期>"
      And 选择客户阶段 "<客户阶段>"
      And 点击「保存」
      Then 系统生成拜访记录
      And 拜访记录关联客户 "<客户名称>"

      Examples:
        | 客户名称       | 拜访日期   | 客户阶段 |
        | 上海星辰科技   | 2025-06-10 | 需求确认 |
        | 华北数码集团   | 2025-06-11 | 意向培养 |

  Rule: 权限查看
    Scenario: 管理者查看所有拜访记录
      Given 管理者进入「拜访记录」页面
      When 页面加载完成
      Then 系统展示全员拜访记录列表
```

### 3.3 Feature: 商机管理

```
Feature: 商机管理
  跟踪潜在合同金额与阶段，提升转化率。

  Background:
    Given 系统已定义「商机阶段配置表」:
      | 阶段         | 顺序 |
      | 立项评估     | 1   |
      | 方案制定     | 2   |
      | 合同谈判     | 3   |
      | 成交/关闭    | 4   |

  Rule: 发起转商机申请
    Scenario: 创建商机申请
      Given 销售人员在拜访记录详情页
      When 点击「转商机申请」
      And 输入预计签单金额 "1000000"
      And 选择产品线 "AI 平台"
      And 选择签单概率 "60%"
      And 点击「提交」
      Then 系统创建状态为 "待审批" 的商机申请
      And 通知对应管理者

  Rule: 维护商机
    Scenario Outline: 更新商机阶段
      Given 商机 "<商机编号>" 当前阶段为 "<原阶段>"
      And 销售人员为该商机负责人
      When 将阶段修改为 "<新阶段>"
      And 点击「保存」
      Then 商机阶段应更新为 "<新阶段>"
      And 系统写入阶段变更历史

      Examples:
        | 商机编号 | 原阶段   | 新阶段   |
        | OP-001   | 立项评估 | 方案制定 |
        | OP-002   | 方案制定 | 合同谈判 |
```

### 3.4 Feature: 审批流程

```
Feature: 审批流程
  管理者对线索转商机申请进行把控，保证质量与合规。

  Background:
    Given 系统已定义「审批状态枚举」:
      | 状态    |
      | 待审批  |
      | 已通过  |
      | 已驳回  |

  Rule: 转商机审批
    Scenario: 管理者审批通过
      Given 商机申请 "OP-003" 状态为 "待审批"
      And 登录用户为对应管理者
      When 点击「通过」
      Then 商机申请状态更新为 "已通过"
      And 商机状态更新为 "进行中"
      And 通知申请人

    Scenario: 管理者驳回
      Given 商机申请 "OP-004" 状态为 "待审批"
      When 输入驳回原因 "信息不足"
      And 点击「驳回」
      Then 申请状态更新为 "已驳回"
      And 通知申请人包含驳回原因

  Rule: 权限校验
    Scenario: 非管理者审批拦截
      Given 销售人员尝试审批商机申请
      When 点击「通过」
      Then 系统提示 "无审批权限"
```

### 3.5 Feature: 统计分析

```
Feature: 统计分析
  提供多维度漏斗与转化率报表，支持权限分级可视化。

  Background:
    Given 系统已定义「报表配置表」:
      | 报表名       | 模板ID |
      | 商机漏斗     | RPT_OP_FUNNEL |
      | 拜访转化率   | RPT_VISIT_CONV |

  Rule: 商机漏斗
    Scenario: 查看商机漏斗
      Given 管理者进入「统计分析」模块
      When 选择报表 "商机漏斗"
      Then 系统展示按阶段聚合的商机数量与金额

  Rule: 拜访转化率
    Scenario Outline: 计算拜访→商机转化率
      Given 统计周期为 "<周期>"
      When 系统自动汇总数据
      Then 报表展示 "<周期>" 内拜访数 <拜访数>、转商机申请数 <申请数>、转化率 <转化率>

      Examples:
        | 周期   | 拜访数 | 申请数 | 转化率 |
        | 本月   | 40    | 8     | 20%   |
        | 本季度 | 120   | 30    | 25%   |

  Rule: 数据权限
    Scenario: 销售人员查看个人数据
      Given 销售人员进入「统计分析」
      When 报表加载完成
      Then 仅展示该销售人员相关的数据指标
```

## 4. 用户体验与边界条件

1. **响应时延**：页面交互 ≤ 150 ms，报表查询 ≤ 3 s。  
2. **分辨率支持**：≥1280×720，自适应布局；移动端提供表格/图表纵向滚动。  
3. **数据完整性**：任何提交失败需前端提示并保持表单数据。  
4. **并发安全**：同一商机编辑冲突时提示“已被他人修改”，可选择刷新。  
5. **访问控制**：遵循最小权限原则，支持部门级与个人级数据隔离。  

## 5. 附录

- **阶段定义**：立项评估、方案制定、合同谈判、成交/关闭。  
- **转商机审批 SLA**：管理者 48 小时内完成审批，超时系统提醒。  
- **计量口径**：  
  - 拜访次数 = 拜访记录条数  
  - 转化率 = 商机申请数 ÷ 拜访记录数  

> 本文档遵循 BDD 最佳实践，所有 Feature/Rule/Scenario 可直接驱动自动化测试与开发实现。
